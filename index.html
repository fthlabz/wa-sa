<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Mağaza | Dijital Çözüm Ortağı</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* PREMIUM DARK GLASSMORPHISM TEMA */
        :root { 
            --bg-color: #0b1120; 
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.3);
            --success: #22c55e;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { 
            background-color: var(--bg-color); 
            background-image: radial-gradient(circle at 15% 50%, rgba(56, 189, 248, 0.04), transparent 25%), radial-gradient(circle at 85% 30%, rgba(34, 197, 94, 0.04), transparent 25%);
            color: var(--text-main); 
            padding-bottom: 90px; 
            min-height: 100vh;
        }

        /* Cam Efektli Header */
        header { 
            background: rgba(11, 17, 32, 0.7); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 5%; 
            display: flex; justify-content: space-between; align-items: center; 
            position: sticky; top: 0; z-index: 100; 
        }
        
        .logo { font-size: 22px; font-weight: 700; letter-spacing: 1px; }
        
        .cart-btn { background: none; border: none; color: var(--text-main); font-size: 24px; cursor: pointer; position: relative; }
        .cart-badge { position: absolute; top: -5px; right: -8px; background: var(--accent); color: #000; font-size: 11px; font-weight: 800; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px var(--accent-glow); }

        /* Ürün Izgarası */
        .container { max-width: 1200px; margin: 30px auto; padding: 0 5%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        
        /* Cam Ürün Kartları */
        .card { 
            background: var(--glass-bg); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); 
            border-radius: 16px; 
            overflow: hidden; 
            display: flex; flex-direction: column; 
            transition: transform 0.3s, border-color 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: rgba(255, 255, 255, 0.2); }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        
        .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 5px; color: var(--text-main); }
        .card-price { font-size: 18px; font-weight: 700; color: var(--accent); margin-bottom: 15px; }
        
        .btn-add { 
            background: transparent; color: var(--text-main); border: 1px solid var(--glass-border); 
            padding: 10px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; 
            margin-top: auto; transition: 0.3s; display: flex; justify-content: center; gap: 8px; align-items: center;
        }
        .btn-add:hover { background: var(--accent); color: #000; border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        /* Gelişmiş Cam Sepet Modalı */
        .cart-modal { 
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 380px; height: 100%; 
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border); z-index: 200; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }
        .cart-modal.active { right: 0; }
        
        .cart-header { padding: 25px 20px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; }
        .cart-header h2 { font-weight: 600; font-size: 20px; }
        .close-cart { background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer; transition: 0.2s; }
        .close-cart:hover { color: var(--text-main); }
        
        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        
        /* Sepet Ürün Düzeni */
        .cart-item { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .cart-item-info { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .cart-item h5 { font-size: 15px; font-weight: 500; }
        
        /* Adet Kontrolü Mimarisi */
        .qty-control { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 5px; }
        .qty-btn { background: none; border: none; color: var(--text-main); width: 30px; height: 30px; font-size: 16px; cursor: pointer; border-radius: 6px; }
        .qty-btn:hover { background: rgba(255,255,255,0.1); }
        .qty-val { font-weight: 600; width: 30px; text-align: center; font-size: 15px; }
        
        .cart-footer { padding: 25px 20px; border-top: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); }
        .total-row { display: flex; justify-content: space-between; font-size: 20px; font-weight: 700; margin-bottom: 20px; }
        .total-price { color: var(--accent); }
        
        .btn-checkout { background: var(--success); color: #fff; border: none; width: 100%; padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; box-shadow: 0 0 20px rgba(34, 197, 94, 0.2); transition: 0.3s; }
        .btn-checkout:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(34, 197, 94, 0.4); }

    </style>
</head>
<body>

<header>
    <div class="logo"><i class="fa-solid fa-gem"></i> Premium</div>
    <button class="cart-btn" onclick="toggleCart()">
        <i class="fa-solid fa-bag-shopping"></i>
        <span class="cart-badge" id="cartCount">0</span>
    </button>
</header>

<div class="container">
    <div class="grid" id="productGrid">
        <div style="grid-column: 1/-1; text-align:center; padding: 50px; color: var(--text-muted);">
            <i class="fa-solid fa-circle-notch fa-spin fa-2x"></i><br><br>VİTRİN HAZIRLANIYOR...
        </div>
    </div>
</div>

<div class="cart-modal" id="cartModal">
    <div class="cart-header">
        <h2>Sepetim</h2>
        <button class="close-cart" onclick="toggleCart()"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-footer">
        <div class="total-row">
            <span>Toplam</span>
            <span class="total-price" id="cartTotal">0 TL</span>
        </div>
        <button class="btn-checkout" onclick="checkout()">
            <i class="fa-brands fa-whatsapp"></i> Siparişi Tamamla
        </button>
    </div>
</div>

<script>
    const WHATSAPP_NO = '905320000000'; // Sadece kendi numaranı yaz

    let cart = [];

    // RAW LINK YERİNE DOĞRUDAN FETCH (Aynı dizinde oldukları için)
    async function loadProducts() {
        try {
            // Önbelleğe takılmamak için sonuna zaman damgası ekliyoruz
            const res = await fetch('depo.json?v=' + new Date().getTime()); 
            const products = await res.json();
            renderProducts(products);
        } catch (err) {
            document.getElementById('productGrid').innerHTML = '<p style="text-align:center; color:#ef4444;"><i class="fa-solid fa-circle-exclamation"></i> Veritabanına bağlanılamadı.</p>';
        }
    }

    function renderProducts(products) {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = '';
        products.reverse().forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${p.img}" alt="${p.name}" loading="lazy">
                <div class="card-body">
                    <div class="card-title">${p.name}</div>
                    <div class="card-price">${p.price} TL</div>
                    <button class="btn-add" onclick="addToCart('${p.id}', '${p.name.replace(/'/g, "\\'")}', ${p.price})">
                        <i class="fa-solid fa-plus"></i> Sepete Ekle
                    </button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function toggleCart() {
        document.getElementById('cartModal').classList.toggle('active');
    }

    function addToCart(id, name, price) {
        const item = cart.find(i => i.id === id);
        if (item) { item.qty++; } 
        else { cart.push({ id, name, price, qty: 1 }); }
        
        updateCartUI();
        if(!document.getElementById('cartModal').classList.contains('active')) toggleCart();
    }

    // YENİ: ADET DEĞİŞTİRME FONKSİYONLARI
    function changeQty(id, delta) {
        const item = cart.find(i => i.id === id);
        if (item) {
            item.qty += delta;
            if (item.qty <= 0) { cart = cart.filter(i => i.id !== id); }
        }
        updateCartUI();
    }

    function updateCartUI() {
        const container = document.getElementById('cartItems');
        let total = 0;
        let count = 0;
        container.innerHTML = '';

        cart.forEach(item => {
            total += item.price * item.qty;
            count += item.qty;
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
                <div class="cart-item-info">
                    <h5>${item.name}</h5>
                    <span style="font-weight:700; color:var(--accent);">${item.price * item.qty} TL</span>
                </div>
                <div class="qty-control">
                    <button class="qty-btn" onclick="changeQty('${item.id}', -1)"><i class="fa-solid fa-minus"></i></button>
                    <span class="qty-val">${item.qty}</span>
                    <button class="qty-btn" onclick="changeQty('${item.id}', 1)"><i class="fa-solid fa-plus"></i></button>
                </div>
            `;
            container.appendChild(div);
        });

        if (cart.length === 0) container.innerHTML = '<div style="text-align:center; color:var(--text-muted); padding-top:40px;"><i class="fa-solid fa-bag-shopping fa-3x" style="opacity:0.2; margin-bottom:15px;"></i><p>Sepetin şu an boş.</p></div>';

        document.getElementById('cartTotal').innerText = total + ' TL';
        document.getElementById('cartCount').innerText = count;
    }

    function checkout() {
        if (cart.length === 0) return;
        let text = "Merhaba, siparişim:\n\n";
        let total = 0;
        cart.forEach(i => {
            text += `▪ ${i.name} (x${i.qty}) = ${i.price * i.qty} TL\n`;
            total += i.price * i.qty;
        });
        text += `\n*TOPLAM:* ${total} TL\nÖdeme: Kapıda Ödeme`;

        window.open(`https://wa.me/${WHATSAPP_NO}?text=${encodeURIComponent(text)}`, '_blank');
    }

    window.onload = loadProducts;
</script>
</body>
</html>
