<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Mağaza | Fthlabz Dijital Çözüm Ortağı</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #111; --accent: #ff6b6b; --bg: #f5f6fa; --card-bg: #fff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); color: var(--primary); padding-bottom: 80px; }
        
        /* Header & Sepet */
        header { background: var(--card-bg); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-size: 20px; font-weight: bold; }
        .cart-btn { background: none; border: none; font-size: 20px; cursor: pointer; position: relative; }
        .cart-badge { position: absolute; top: -8px; right: -10px; background: var(--accent); color: white; font-size: 12px; font-weight: bold; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* Ürün Izgarası */
        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: var(--card-bg); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.02); display: flex; flex-direction: column; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-body { padding: 12px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 14px; margin-bottom: 5px; font-weight: 600; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .card-price { font-size: 16px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .add-to-cart { background: var(--primary); color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer; margin-top: auto; font-size: 13px; font-weight: 600; transition: 0.2s; }
        .add-to-cart:hover { opacity: 0.8; }

        /* Sepet Modalı */
        .cart-modal { position: fixed; top: 0; right: -100%; width: 100%; max-width: 350px; height: 100%; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); z-index: 200; transition: 0.3s; display: flex; flex-direction: column; }
        .cart-modal.active { right: 0; }
        .cart-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .close-cart { background: none; border: none; font-size: 20px; cursor: pointer; }
        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #f5f5f5; padding-bottom: 10px; }
        .cart-item h5 { font-size: 13px; margin-bottom: 5px; }
        .remove-item { color: var(--accent); cursor: pointer; font-size: 12px; border: none; background: none; }
        .cart-footer { padding: 20px; border-top: 1px solid #eee; }
        .checkout-btn { background: #25D366; color: white; border: none; width: 100%; padding: 15px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }

        /* Pop-up */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 300; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .popup { background: white; padding: 30px; border-radius: 16px; width: 90%; max-width: 380px; text-align: center; position: relative; }
        .popup-close { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 20px; color: #888; cursor: pointer; }
        .popup-icon { font-size: 40px; color: #f1c40f; margin-bottom: 15px; }
        .popup-btn-success { display: block; background: #25D366; color: white; text-decoration: none; padding: 12px; border-radius: 8px; font-weight: bold; margin-bottom: 10px; }
        .popup-btn-outline { display: block; background: white; color: var(--primary); text-decoration: none; padding: 12px; border-radius: 8px; font-weight: bold; border: 1px solid #ddd; }
    </style>
</head>
<body>

<header>
    <div class="logo"><i class="fa-solid fa-store"></i> Mağaza</div>
    <button class="cart-btn" onclick="toggleCart()">
        <i class="fa-solid fa-cart-shopping"></i>
        <span class="cart-badge" id="cartCount">0</span>
    </button>
</header>

<div class="container">
    <div class="grid" id="productGrid">
        <p><i class="fa-solid fa-spinner fa-spin"></i> Ürünler yükleniyor...</p>
    </div>
</div>

<div class="cart-modal" id="cartModal">
    <div class="cart-header">
        <h2>Sepetim</h2>
        <button class="close-cart" onclick="toggleCart()"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-footer">
        <h3 style="margin-bottom: 15px; display: flex; justify-content: space-between;">Toplam: <span id="cartTotal">0 TL</span></h3>
        <button class="checkout-btn" onclick="checkout()">
            <i class="fa-brands fa-whatsapp"></i> Sipariş Ver (Kapıda Ödeme)
        </button>
    </div>
</div>

<div class="overlay" id="feedbackPopup">
    <div class="popup">
        <button class="popup-close" onclick="closePopup()"><i class="fa-solid fa-xmark"></i></button>
        <div class="popup-icon"><i class="fa-solid fa-star"></i></div>
        <h3 style="margin-bottom: 10px;">Bizi Nasıl Buldunuz?</h3>
        <p style="color: #666; font-size: 14px; margin-bottom: 20px;">Size daha iyi hizmet verebilmek için fikriniz bizim için çok değerli!</p>
        
        <a href="#" id="waMemnunBtn" target="_blank" onclick="closePopup()" class="popup-btn-success">
           <i class="fa-solid fa-check"></i> Çok Memnunum!
        </a>
        <a href="#" id="waOneriBtn" target="_blank" onclick="closePopup()" class="popup-btn-outline">
           <i class="fa-regular fa-lightbulb"></i> Bir Önerim Var
        </a>
    </div>
</div>

<script>
    // --- AYARLAR ---
    // GitHub'daki depo.json'un RAW linkini buraya yapıştır:
    const DEPO_RAW_URL = 'https://raw.githubusercontent.com/fthlabz/wa-sa/refs/heads/main/depo.json';
    const WHATSAPP_NO = '905373583095'; // Başında + olmadan numara

    // WhatsApp Linklerini Ayarla
    document.getElementById('waMemnunBtn').href = `https://wa.me/${WHATSAPP_NO}?text=Merhaba,%20sitenizi%20inceledim%20ve%20hizmetinizden%20çok%20memnun%20kaldım!`;
    document.getElementById('waOneriBtn').href = `https://wa.me/${WHATSAPP_NO}?text=Merhaba,%20sitenizle%20ilgili%20birkaç%20önerim%20var.`;

    let cart = [];

    // Ürünleri Çek
    async function loadProducts() {
        try {
            // URL sonuna rastgele sayı eklemek tarayıcı önbelleğini atlar (önemli!)
            const res = await fetch(DEPO_RAW_URL + '?v=' + new Date().getTime());
            const products = await res.json();
            renderProducts(products);
        } catch (err) {
            document.getElementById('productGrid').innerHTML = '<p><i class="fa-solid fa-triangle-exclamation"></i> Ürünler şu an yüklenemiyor.</p>';
        }
    }

    function renderProducts(products) {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = '';
        products.reverse().forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${p.img}" alt="${p.name}">
                <div class="card-body">
                    <div class="card-title">${p.name}</div>
                    <div class="card-price">${p.price} TL</div>
                    <button class="add-to-cart" onclick="addToCart('${p.id}', '${p.name.replace(/'/g, "\\'")}', ${p.price})">
                        <i class="fa-solid fa-cart-plus"></i> Sepete Ekle
                    </button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // Sepet İşlemleri
    function toggleCart() {
        document.getElementById('cartModal').classList.toggle('active');
    }

    function addToCart(id, name, price) {
        const item = cart.find(i => i.id === id);
        if (item) item.qty++;
        else cart.push({ id, name, price, qty: 1 });
        updateCartUI();
        
        // Sepeti otomatik açarak kullanıcıya sepete eklendiğini gösterelim
        if(!document.getElementById('cartModal').classList.contains('active')) {
            toggleCart();
        }
    }

    function removeFromCart(id) {
        cart = cart.filter(i => i.id !== id);
        updateCartUI();
    }

    function updateCartUI() {
        const container = document.getElementById('cartItems');
        let total = 0;
        let count = 0;
        container.innerHTML = '';

        cart.forEach(item => {
            total += item.price * item.qty;
            count += item.qty;
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
                <div>
                    <h5>${item.name} (x${item.qty})</h5>
                    <span style="font-weight:bold; color:var(--accent); font-size:14px;">${item.price * item.qty} TL</span>
                </div>
                <button class="remove-item" onclick="removeFromCart('${item.id}')"><i class="fa-solid fa-trash"></i></button>
            `;
            container.appendChild(div);
        });

        if (cart.length === 0) container.innerHTML = '<p style="text-align:center; color:#888; margin-top:20px;">Sepetiniz boş.</p>';

        document.getElementById('cartTotal').innerText = total + ' TL';
        document.getElementById('cartCount').innerText = count;
    }

    function checkout() {
        if (cart.length === 0) { alert("Sepetiniz boş!"); return; }
        
        let text = "Merhaba, sipariş vermek istiyorum:\n\n";
        let total = 0;
        cart.forEach(i => {
            text += `- ${i.name} (x${i.qty}) : ${i.price * i.qty} TL\n`;
            total += i.price * i.qty;
        });
        text += `\n*TOPLAM: ${total} TL*\nÖdeme: Kapıda Ödeme`;

        const encodedText = encodeURIComponent(text);
        window.open(`https://wa.me/${WHATSAPP_NO}?text=${encodedText}`, '_blank');
    }

    // Pop-up Mantığı
    window.onload = function() {
        loadProducts();
        if(!sessionStorage.getItem('popupShown')) {
            setTimeout(() => { document.getElementById('feedbackPopup').style.display = 'flex'; }, 2000);
        }
    };

    function closePopup() {
        document.getElementById('feedbackPopup').style.display = 'none';
        sessionStorage.setItem('popupShown', 'true');
    }
</script>
</body>
</html>
